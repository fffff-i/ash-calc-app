<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <title>AshCalc Test</title>
</head>
<body>
<h1>AshTale Damage Calculator</h1>
<button id="calc">計算</button>
<pre id="expected" style="border:1px solid #ccc;padding:10px;margin-top:1em"></pre>
<pre id="crit" style="border:1px solid #ccc;padding:10px;margin-top:1em"></pre>
<pre id="non_crit" style="border:1px solid #ccc;padding:10px;margin-top:1em"></pre>

<script type="module">
    import init, { calc_damage_verbose_js, get_skill_list } from "../core/pkg";

    async function main() {
        await init();

        const params = {
            atk: 45000,
            enemy_def: 3600,
            enemy_def_rate: 1.5,
            ignore_def_rate: 1.0,
            intimidation: 100,
            fortitude: 20,
            damage_amp: 1.0,
            abnormal_bonus: 0.0,
            hp_high_bonus: 0.1,
            hp_low_bonus: 0.0,
            skill_bonus: 0.0,
            boss_bonus: 0.5,
            monster_bonus: 0.0,
            crit_rate: 3.0,
            enemy_crit_resist: 0.0,
            crit_damage: 5.0,
            is_boss: true,
            is_high_hp: true,
            is_abnormal: false
        };

        const skills = [
            { id: "fate_spell", additional_level: 10 }
        ];

        document.getElementById("calc").onclick = () => {
            const breakdown = calc_damage_verbose_js(params, skills);
            console.log(breakdown);
            document.getElementById("expected").textContent = `Expected: ${breakdown.expected_damage}`;
            document.getElementById("crit").textContent = `Crit: ${breakdown.crit}`;
            document.getElementById("non_crit").textContent = `Non-Crit: ${breakdown.non_crit}`;
        };

        // 確認用スキル一覧ログ
        console.log("Skills:", get_skill_list());
    }

    main();
</script>
</body>
</html>
